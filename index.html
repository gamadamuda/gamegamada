<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gamada Retro Quest</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        /* --- RETRO AESTHETICS --- */
        :root { --neon-blue: #00f3ff; --neon-pink: #ff00ff; --dark-bg: #0a0a0a; }
        
        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            touch-action: none; /* Mencegah zoom di HP */
            user-select: none;
        }

        /* Scanline Effect (Efek TV Tabung) */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* Scaling Engine */
        #game-container {
            transform-origin: center center;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            width: 900px;
            height: 500px;
            position: relative;
            /* Border Retro Keren */
            border: 4px solid #333;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2), inset 0 0 50px rgba(0,0,0,0.8);
            background: #111;
            border-radius: 20px;
            overflow: hidden;
        }

        /* Utilities */
        .center-flex { display: flex; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
        
        /* Orientation Warning */
        #rotate-lock {
            position: fixed; inset: 0; z-index: 9999; background: #0f172a;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        @media screen and (max-width: 768px) and (orientation: portrait) {
            #rotate-lock { display: flex; }
            #app-root { display: none; }
        }

        /* SOS Grid Animation */
        .sos-cell {
            background: #1e293b; border: 2px solid #334155;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: 0.2s;
        }
        .sos-cell:active { transform: scale(0.9); }
        .sos-cell.winner { background: #22c55e; color: black; animation: pulse 0.5s infinite; }

        /* Animations */
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .pop-up-anim { animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>

    <div id="rotate-lock">
        <i class="fas fa-sync-alt text-6xl text-yellow-400 animate-spin mb-4" style="animation-duration:3s"></i>
        <h1 class="text-xs text-yellow-400 mb-2">PUTAR HP KAMU</h1>
        <p class="text-[8px] text-gray-400">Mode Landscape Diperlukan</p>
    </div>

    <div id="app-root" class="fixed inset-0 bg-black flex items-center justify-center">
        
        <div class="absolute inset-0 opacity-10" 
             style="background-image: linear-gradient(#4ade80 1px, transparent 1px), linear-gradient(90deg, #4ade80 1px, transparent 1px); background-size: 40px 40px;">
        </div>

        <a href="index.html" class="absolute top-4 left-4 z-50 text-red-500 border border-red-500 px-3 py-2 rounded text-[8px] hover:bg-red-500 hover:text-white transition cursor-pointer">
            <i class="fas fa-power-off mr-2"></i>KELUAR
        </a>

        <div id="start-screen" class="absolute z-40 text-center animate-bounce">
            <h1 class="text-3xl md:text-5xl text-yellow-400 mb-4" style="text-shadow: 4px 4px 0 #000;">GAMADA QUEST</h1>
            <p class="text-[10px] text-blue-300 mb-8">Selesaikan 3 Level untuk Masuk</p>
            <button onclick="startGame()" class="bg-blue-600 border-b-4 border-blue-800 text-white px-8 py-4 rounded text-xs hover:scale-105 transition active:border-b-0 active:translate-y-1">
                START MISSION â–¶
            </button>
        </div>

        <div id="game-container" class="hidden crt">
            
            <div id="lvl-1" class="absolute inset-0 bg-gray-900 z-10 hidden flex-col items-center justify-center">
                <div class="absolute top-4 w-full text-center">
                    <h2 class="text-yellow-400 text-sm">LVL 1: SOS BATTLE</h2>
                    <p class="text-[8px] text-gray-400 mt-1">Bentuk S-O-S (Horizontal/Vertikal)</p>
                </div>
                
                <div class="flex gap-8 mt-6">
                    <div id="sos-board" class="grid grid-cols-6 gap-1 bg-gray-800 p-2 rounded border-4 border-gray-700"></div>
                    
                    <div class="flex flex-col gap-2 justify-center w-32">
                        <div class="text-[8px] text-center mb-1">PILIH:</div>
                        <div class="flex gap-2 justify-center">
                            <button onclick="setLetter('S')" id="btn-s" class="w-10 h-10 bg-blue-600 rounded border-b-4 border-blue-800 text-white font-bold ring-2 ring-white">S</button>
                            <button onclick="setLetter('O')" id="btn-o" class="w-10 h-10 bg-gray-600 rounded border-b-4 border-gray-700 text-white font-bold">O</button>
                        </div>
                        <div id="turn-indicator" class="mt-4 text-[8px] text-center text-green-400 blink">GILIRANMU</div>
                    </div>
                </div>
            </div>

            <div id="lvl-2" class="absolute inset-0 bg-gray-900 z-10 hidden flex-col items-center justify-center">
                <h2 class="text-green-400 text-sm mb-6">LVL 2: MEMORY</h2>
                <p id="mem-status" class="text-[8px] mb-4 text-gray-300">Perhatikan Pola...</p>
                <div class="grid grid-cols-2 gap-4">
                    <div id="p-1" onclick="memClick(1)" class="w-24 h-24 bg-green-900 border-4 border-green-600 rounded transition opacity-60 hover:opacity-80 active:bg-green-400"></div>
                    <div id="p-2" onclick="memClick(2)" class="w-24 h-24 bg-red-900 border-4 border-red-600 rounded transition opacity-60 hover:opacity-80 active:bg-red-400"></div>
                    <div id="p-3" onclick="memClick(3)" class="w-24 h-24 bg-yellow-900 border-4 border-yellow-600 rounded transition opacity-60 hover:opacity-80 active:bg-yellow-400"></div>
                    <div id="p-4" onclick="memClick(4)" class="w-24 h-24 bg-blue-900 border-4 border-blue-600 rounded transition opacity-60 hover:opacity-80 active:bg-blue-400"></div>
                </div>
            </div>

            <div id="lvl-3" class="absolute inset-0 bg-gray-900 z-10 hidden flex-col items-center justify-center">
                <h2 class="text-pink-400 text-sm mb-2">LVL 3: TEBAK GAMBAR</h2>
                
                <div class="relative w-32 h-32 bg-white rounded-full border-4 border-gray-600 overflow-hidden mb-6 flex items-center justify-center">
                    <div id="q-img" class="text-[8rem] absolute transform scale-[4] translate-y-4 blur-[1px]">ðŸŽ¤</div>
                </div>

                <div id="q-options" class="grid grid-cols-2 gap-3 w-3/4">
                    </div>
                <p id="q-msg" class="text-[8px] h-4 mt-2 text-red-400"></p>
            </div>

            <div id="lvl-final" class="absolute inset-0 bg-[#111] z-20 hidden flex items-center justify-center">
                
                <div class="relative w-[800px] h-[380px] bg-[#1a1a1a] rounded-[50px] shadow-[0_10px_30px_rgba(0,0,0,0.8)] border-b-[6px] border-black flex items-center justify-between px-10 scale-90">
                    
                    <div class="flex flex-col gap-4">
                        <div class="w-24 h-24 bg-[#222] rounded-full border-2 border-black flex items-center justify-center shadow-inner relative">
                            <div class="absolute w-8 h-20 bg-[#111] rounded"></div>
                            <div class="absolute w-20 h-8 bg-[#111] rounded"></div>
                            <i class="fas fa-caret-up absolute top-1 text-gray-600"></i>
                            <i class="fas fa-caret-down absolute bottom-1 text-gray-600"></i>
                            <i class="fas fa-caret-left absolute left-1 text-gray-600"></i>
                            <i class="fas fa-caret-right absolute right-1 text-gray-600"></i>
                        </div>
                        <div class="w-12 h-12 bg-[#222] rounded-full border-2 border-black shadow-lg mx-auto flex items-center justify-center">
                            <div class="w-8 h-8 bg-[#333] rounded-full border border-gray-600"></div>
                        </div>
                    </div>

                    <div class="relative w-[480px] h-[272px] bg-black border-[4px] border-[#222] rounded shadow-inner overflow-hidden group">
                        <video id="final-video" class="w-full h-full object-cover" playsinline>
                            <source src="https://image2url.com/r2/default/videos/1768394132781-01d59a63-23e0-43fe-aeaa-29c206bfe40b.mp4" type="video/mp4">
                        </video>
                        
                        <div class="absolute top-2 right-2 text-[6px] bg-black/50 px-2 rounded text-white/50">GAMADA TV</div>

                        <div id="rpg-popup" class="hidden absolute inset-0 z-50 flex items-end justify-center pb-2 bg-black/70 backdrop-blur-sm">
                            <div class="relative w-[95%] flex items-end pop-up-anim">
                                <img src="https://image2url.com/r2/bucket1/images/1768407021319-4927f804-d922-4402-9907-f376f92024b4.png" 
                                     class="w-20 z-10 -mr-4 drop-shadow-xl filter brightness-110">
                                
                                <div class="flex-1 bg-blue-900 border-[3px] border-white shadow-[4px_4px_0_black] p-2 rounded relative z-0">
                                    <div class="absolute -top-3 left-0 bg-yellow-400 border border-white px-2 shadow-sm">
                                        <span class="text-blue-900 text-[6px] font-bold">INFO_BOT</span>
                                    </div>
                                    <p class="text-white text-[6px] leading-relaxed mt-1 mb-1">
                                        Selamat! Kamu berhasil menamatkan misi.<br>
                                        Jangan lupa <span class="text-yellow-300">Scan QR Code</span> di video ya!<br>
                                        Gabung grup WA sekarang.
                                    </p>
                                    <div class="flex justify-end gap-2 pt-1 border-t border-blue-700 mt-1">
                                        <button onclick="vidReplay()" class="px-2 py-0.5 bg-gray-600 text-white text-[6px] border border-white">ULANG</button>
                                        <a href="https://padlet.com" target="_blank" class="px-2 py-0.5 bg-yellow-500 text-blue-900 font-bold text-[6px] border border-white">PADLET âž¤</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-4">
                        <div class="w-24 h-24 bg-[#222] rounded-full border-2 border-black shadow-inner grid grid-cols-3 grid-rows-3 p-1 rotate-45">
                            <button onclick="vidToggle()" class="col-start-2 row-start-1 -rotate-45 active:scale-90"><i class="fas fa-caret-up text-green-500 text-xl"></i></button>
                            <button onclick="vidFull()" class="col-start-3 row-start-2 -rotate-45 active:scale-90"><i class="far fa-circle text-red-500 text-lg font-bold"></i></button>
                            <button onclick="vidReplay()" class="col-start-2 row-start-3 -rotate-45 active:scale-90"><i class="fas fa-times text-blue-500 text-lg"></i></button>
                            <button onclick="vidMute()" class="col-start-1 row-start-2 -rotate-45 active:scale-90"><i class="far fa-square text-pink-500 text-sm font-bold"></i></button>
                        </div>
                        <div class="w-12 h-12 bg-[#222] rounded-full border-2 border-black shadow-lg mx-auto flex items-center justify-center"><div class="w-8 h-8 bg-[#333] rounded-full border border-gray-600"></div></div>
                    </div>

                    <div class="absolute bottom-2 w-full text-center left-0 text-[8px] text-gray-600 font-bold tracking-[0.5em]">PS VITA</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- ENGINE VARS ---
        const container = document.getElementById('game-container');
        let currentLevel = 0;

        // --- INIT ---
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            
            // Fullscreen Attempt
            const el = document.documentElement;
            if(el.requestFullscreen) el.requestFullscreen().catch(()=>{});
            
            // Auto Scale
            window.addEventListener('resize', autoScale);
            autoScale();

            // Start Lvl 1
            goToLevel(1);
        }

        function autoScale() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            // Target size 900x500
            const scale = Math.min(w / 950, h / 550);
            container.style.transform = `scale(${scale})`;
        }

        function goToLevel(lvl) {
            ['lvl-1','lvl-2','lvl-3','lvl-final'].forEach(id => document.getElementById(id).classList.add('hidden'));
            
            if(lvl === 1) {
                document.getElementById('lvl-1').classList.remove('hidden');
                document.getElementById('lvl-1').classList.add('flex');
                initSOS();
            } else if(lvl === 2) {
                document.getElementById('lvl-2').classList.remove('hidden');
                document.getElementById('lvl-2').classList.add('flex');
                initMem();
            } else if(lvl === 3) {
                document.getElementById('lvl-3').classList.remove('hidden');
                document.getElementById('lvl-3').classList.add('flex');
                initQuiz();
            } else {
                document.getElementById('lvl-final').classList.remove('hidden');
                document.getElementById('lvl-final').classList.add('flex');
                setTimeout(() => document.getElementById('final-video').play(), 500);
            }
        }

        // --- LVL 1: SOS LOGIC ---
        let sosBoard = [], turn = 'S', isPlayer = true;
        
        function initSOS() {
            const b = document.getElementById('sos-board');
            b.innerHTML = '';
            sosBoard = Array(18).fill(null);
            for(let i=0; i<18; i++) {
                const d = document.createElement('div');
                d.className = 'sos-cell';
                d.id = `sos-${i}`;
                d.onclick = () => sosClick(i);
                b.appendChild(d);
            }
            turn = 'S'; isPlayer = true;
            document.getElementById('turn-indicator').innerText = "GILIRANMU";
            updateBtnState();
        }

        function setLetter(l) {
            turn = l; updateBtnState();
        }

        function updateBtnState() {
            document.getElementById('btn-s').classList.toggle('ring-2', turn === 'S');
            document.getElementById('btn-o').classList.toggle('ring-2', turn === 'O');
        }

        function sosClick(idx) {
            if(!isPlayer || sosBoard[idx]) return;
            makeMove(idx, turn);
            if(checkWin(idx)) {
                setTimeout(() => { alert("MENANG!"); goToLevel(2); }, 200);
                return;
            }
            isPlayer = false;
            document.getElementById('turn-indicator').innerText = "BOT MIKIR...";
            setTimeout(botMove, 800);
        }

        function botMove() {
            let empty = sosBoard.map((v, i) => v === null ? i : null).filter(v => v !== null);
            if(empty.length === 0) { initSOS(); return; }
            
            let move = empty[Math.floor(Math.random() * empty.length)];
            let char = Math.random() > 0.5 ? 'S' : 'O';
            makeMove(move, char, true);
            
            if(checkWin(move)) {
                setTimeout(() => { alert("BOT MENANG. ULANGI."); initSOS(); }, 200);
            } else {
                isPlayer = true;
                document.getElementById('turn-indicator').innerText = "GILIRANMU";
            }
        }

        function makeMove(idx, char, isBot = false) {
            sosBoard[idx] = char;
            const el = document.getElementById(`sos-${idx}`);
            el.innerText = char;
            el.style.color = isBot ? '#f87171' : '#60a5fa';
        }

        function checkWin(idx) {
            // Simple Horizontal Check for 3x6 grid
            const row = Math.floor(idx / 6);
            const col = idx % 6;
            
            // Cek Horizontal (S-O-S)
            // Logic Sederhana: Cek string pattern di baris tersebut
            let rStart = row * 6;
            let line = sosBoard.slice(rStart, rStart+6).map(v => v || '_').join('');
            return line.includes('SOS');
        }

        // --- LVL 2: MEMORY ---
        let seq = [], uSeq = [];
        function initMem() {
            seq = []; addSeq();
        }
        function addSeq() {
            uSeq = [];
            seq.push(Math.ceil(Math.random()*4));
            playSeq();
        }
        function playSeq() {
            let i=0;
            document.getElementById('mem-status').innerText = "Hafalkan...";
            const t = setInterval(() => {
                hl(seq[i]); i++;
                if(i>=seq.length) { clearInterval(t); document.getElementById('mem-status').innerText = "Giliranmu!"; }
            }, 600);
        }
        function hl(id) {
            const el = document.getElementById('p-'+id);
            el.style.opacity = '1';
            setTimeout(() => el.style.opacity = '0.6', 300);
        }
        function memClick(id) {
            hl(id); uSeq.push(id);
            if(uSeq[uSeq.length-1] !== seq[uSeq.length-1]) {
                alert("Salah!"); initMem(); return;
            }
            if(uSeq.length === seq.length) {
                if(seq.length === 3) {
                    setTimeout(() => goToLevel(3), 500);
                } else setTimeout(addSeq, 800);
            }
        }

        // --- LVL 3: QUIZ ---
        const qs = [
            { em:"ðŸ¥¥", zm:"scale(5)", ops:["Planet Mars", "Batok Kelapa"], ans:1 },
            { em:"ðŸŽ¤", zm:"scale(4)", ops:["Mic Dosen", "Gagang Pintu"], ans:0 }
        ];
        let qI = 0;
        function initQuiz() {
            qI = 0; loadQ();
        }
        function loadQ() {
            if(qI >= qs.length) { goToLevel(4); return; }
            const q = qs[qI];
            document.getElementById('q-img').innerText = q.em;
            document.getElementById('q-img').style.transform = q.zm;
            const c = document.getElementById('q-options');
            c.innerHTML = '';
            q.ops.forEach((o, i) => {
                const b = document.createElement('button');
                b.className = "bg-gray-700 hover:bg-gray-600 py-3 rounded text-[10px] border border-gray-500";
                b.innerText = o;
                b.onclick = () => {
                    if(i === q.ans) { qI++; loadQ(); }
                    else document.getElementById('q-msg').innerText = "SALAH! :P";
                }
                c.appendChild(b);
            });
        }

        // --- VIDEO ---
        const v = document.getElementById('final-video');
        const pop = document.getElementById('rpg-popup');
        v.addEventListener('ended', () => { v.pause(); pop.classList.remove('hidden'); });
        function vidToggle() { v.paused ? v.play() : v.pause(); pop.classList.add('hidden'); }
        function vidReplay() { v.currentTime = 0; v.play(); pop.classList.add('hidden'); }
        function vidMute() { v.muted = !v.muted; }
        function vidFull() { 
            const el = document.getElementById('game-container');
            if(el.requestFullscreen) el.requestFullscreen();
        }

        // Start Resizer
        window.addEventListener('load', autoScale);
    </script>
</body>
</html>
